<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="brand">
        <img src="assets/lr.jpeg" alt="LeaseRight Logo" class="logo">
        <h1>Admin Panel</h1>
      </div>
      <div class="user-section">
        <div class="search-box">
          <input type="text" placeholder="Search users..." [(ngModel)]="searchQuery">
          <i class="fas fa-search"></i>
        </div>
        <button class="btn-logout" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">

    <!-- Welcome Section -->
    <div class="welcome-section">
      <h2>Welcome back, {{ userName }}! ðŸ‘‹</h2>
      <p>Manage all users, vendors, and companies across the platform</p>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon admin">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-details">
          <h3>Total Users</h3>
          <p class="stat-number">{{ stats.totalUsers }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon admin">
          <i class="fas fa-user-tie"></i>
        </div>
        <div class="stat-details">
          <h3>Total Vendors</h3>
          <p class="stat-number">{{ stats.totalVendors }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon admin">
          <i class="fas fa-building"></i>
        </div>
        <div class="stat-details">
          <h3>Total Companies</h3>
          <p class="stat-number">{{ stats.totalCompanies }}</p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="actions-section">
      <h3>Quick Actions</h3>
      <div class="actions-grid">
        <button class="action-btn" (click)="loadAllUsers()">
          <i class="fas fa-users"></i>
          Load All Users
        </button>
        <button class="action-btn" (click)="loadVendors()">
          <i class="fas fa-user-tie"></i>
          Load Vendors
        </button>
        <button class="action-btn" (click)="loadCompanies()">
          <i class="fas fa-building"></i>
          Load Companies
        </button>
        <button class="action-btn" (click)="refreshData()">
          <i class="fas fa-sync-alt"></i>
          Refresh Data
        </button>
        <button class="action-btn" (click)="exportData()">
          <i class="fas fa-download"></i>
          Export Data
        </button>
      </div>
    </div>

    <!-- Recent Activities -->
    <div class="activities-section" *ngIf="recentActivities.length > 0">
      <h3>Recent Activities</h3>
      <div class="activities-list">
        <div class="activity-item" *ngFor="let activity of recentActivities | slice:0:5">
          <div class="activity-icon" [class.success]="activity.action === 'registered'" [class.pending]="activity.action === 'pending_verification'">
            <i class="fas" [class.fa-check-circle]="activity.action === 'registered'" [class.fa-clock]="activity.action === 'pending_verification'"></i>
          </div>
          <div class="activity-details">
            <p class="activity-text">{{ activity.description }}</p>
            <span class="activity-time">{{ activity.timestamp | date:'short' }}</span>
          </div>
          <span class="activity-badge" [class.badge-success]="activity.action === 'registered'" [class.badge-pending]="activity.action === 'pending_verification'">
            {{ activity.action === 'registered' ? 'Completed' : 'Pending' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Users Management Section -->
    <div class="users-section">
        <div class="table-header">
          <h3 class="card-title">User Management</h3>
          <div class="table-tabs">
            <button class="tab-btn" [class.active]="activeTab === 'all'" (click)="setActiveTab('all')">All Users ({{ stats.totalUsers }})</button>
            <button class="tab-btn" [class.active]="activeTab === 'vendors'" (click)="setActiveTab('vendors')">Vendors ({{ stats.totalVendors }})</button>
            <button class="tab-btn" [class.active]="activeTab === 'companies'" (click)="setActiveTab('companies')">Companies ({{ stats.totalCompanies }})</button>
            <button class="tab-btn" [class.active]="activeTab === 'pending'" (click)="setActiveTab('pending')">Pending ({{ stats.pendingRequests }})</button>
          </div>
        </div>

        <div class="table-container">
          <table class="users-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Contact</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of getFilteredUsers()" class="table-row">
                <td>{{ user.id }}</td>
                <td>
                  <div class="user-cell">
                    <div class="user-avatar">{{ user.name.charAt(0).toUpperCase() }}</div>
                    <span>{{ user.name }}</span>
                  </div>
                </td>
                <td>{{ user.mail }}</td>
                <td>
                  <span class="role-badge" [class.vendor]="user.role === 'vendor'" [class.company]="user.role === 'company'" [class.admin]="user.role === 'admin'">
                    {{ user.role }}
                  </span>
                </td>
                <td>{{ user.contactNo || 'N/A' }}</td>
                <td>
                  <span class="status-badge" [class.verified]="user.isVerified" [class.pending]="!user.isVerified">
                    {{ user.isVerified ? 'Verified' : 'Pending' }}
                  </span>
                </td>
                <td>
                  <div class="action-btns">
                    <button class="icon-btn" (click)="viewUser(user)" title="View">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="icon-btn" (click)="approveUser(user)" *ngIf="!user.isVerified" title="Approve">
                      <i class="fas fa-check"></i>
                    </button>
                    <button class="icon-btn danger" (click)="deleteUser(user)" title="Delete">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="no-data" *ngIf="getFilteredUsers().length === 0">
            <i class="fas fa-inbox"></i>
            <p>No users found</p>
          </div>
        </div>

        <!-- Load More Button -->
        <div class="load-more-section" *ngIf="getFilteredUsers().length > 0 && hasMoreData">
          <button class="load-more-btn" (click)="loadMoreUsers()" [disabled]="isLoading">
            <i class="fas" [class.fa-spinner]="isLoading" [class.fa-spin]="isLoading" [class.fa-arrow-down]="!isLoading"></i>
            {{ isLoading ? 'Loading...' : 'Load More Users' }}
          </button>
        </div>
    </div>
  </main>
</div>

<!-- User Details Modal -->
<div class="modal-overlay" *ngIf="selectedUser" (click)="closeUserModal()">
  <div class="modal-panel" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>User Details</h3>
      <button class="modal-close" (click)="closeUserModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="user-profile-section">
        <div class="user-avatar-large">{{ selectedUser.name?.charAt(0).toUpperCase() }}</div>
        <div class="user-profile-info">
          <h4>{{ selectedUser.name }}</h4>
          <span class="role-badge" [class.vendor]="selectedUser.role === 'vendor'" [class.company]="selectedUser.role === 'company'" [class.admin]="selectedUser.role === 'admin'">
            {{ selectedUser.role }}
          </span>
        </div>
      </div>

      <div class="user-details-grid">
        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-hashtag"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">User ID</span>
            <span class="detail-value">{{ selectedUser.id }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">Email Address</span>
            <span class="detail-value">{{ selectedUser.mail }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-phone"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">Contact Number</span>
            <span class="detail-value">{{ selectedUser.contactNo || 'Not provided' }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-building"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">GST Number</span>
            <span class="detail-value">{{ selectedUser.gstNo || 'Not provided' }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">Verification Status</span>
            <span class="status-badge" [class.verified]="selectedUser.isVerified" [class.pending]="!selectedUser.isVerified">
              {{ selectedUser.isVerified ? 'Verified' : 'Pending Verification' }}
            </span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <i class="fas fa-calendar"></i>
          </div>
          <div class="detail-content">
            <span class="detail-label">Registration Date</span>
            <span class="detail-value">{{ selectedUser.createdAt | date:'medium' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeUserModal()">Close</button>
      <button class="btn-approve" *ngIf="!selectedUser.isVerified" (click)="approveUser(selectedUser)">
        <i class="fas fa-check"></i> Approve User
      </button>
      <button class="btn-danger" (click)="deleteUser(selectedUser)">
        <i class="fas fa-trash"></i> Delete User
      </button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="confirm-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="confirm-panel" (click)="$event.stopPropagation()">
    <div class="confirm-icon" [class.delete]="confirmAction === 'delete'" [class.approve]="confirmAction === 'approve'">
      <i class="fas" [class.fa-trash-alt]="confirmAction === 'delete'" [class.fa-check-circle]="confirmAction === 'approve'"></i>
    </div>
    
    <div class="confirm-content">
      <h3 *ngIf="confirmAction === 'delete'">Delete User</h3>
      <h3 *ngIf="confirmAction === 'approve'">Approve User</h3>
      
      <p *ngIf="confirmAction === 'delete'">
        Are you sure you want to delete <strong>{{ confirmUser?.name }}</strong>?
        <br><span class="warning-text">This action cannot be undone.</span>
      </p>
      <p *ngIf="confirmAction === 'approve'">
        Are you sure you want to approve <strong>{{ confirmUser?.name }}</strong>?
        <br><span class="info-text">This will verify the user account.</span>
      </p>
    </div>

    <div class="confirm-actions">
      <button class="btn-cancel" (click)="closeConfirmModal()">
        <i class="fas fa-times"></i> Cancel
      </button>
      <button class="btn-confirm" [class.delete]="confirmAction === 'delete'" [class.approve]="confirmAction === 'approve'" (click)="executeConfirmedAction()">
        <i class="fas" [class.fa-trash]="confirmAction === 'delete'" [class.fa-check]="confirmAction === 'approve'"></i>
        {{ confirmAction === 'delete' ? 'Yes, Delete' : 'Yes, Approve' }}
      </button>
    </div>
  </div>
</div>

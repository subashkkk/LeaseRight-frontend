<div class="quotations-container">
  <!-- Header with Refresh -->
  <div class="section-header">
    <h3>üìã Received Quotations</h3>
    <button class="btn-refresh" (click)="refreshQuotations()" [disabled]="isLoading">
      <span *ngIf="!isLoading">üîÑ Refresh</span>
      <span *ngIf="isLoading">‚è≥ Loading...</span>
    </button>
  </div>

  <!-- Success Alert -->
  <div *ngIf="successMessage" class="alert success">
    <span class="close-btn" (click)="successMessage = null">&times;</span>
    {{ successMessage }}
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert error">
    <span class="close-btn" (click)="error = null">&times;</span>
    {{ error }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading quotations...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="content">
    <!-- Filters and Search -->
    <div class="filters-container">
      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="onSearch()"
          placeholder="Search by ID, vendor, or request..."
          class="search-input"
        >
        <span class="search-icon">üîç</span>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label for="statusFilter">Status:</label>
          <select 
            id="statusFilter" 
            [(ngModel)]="statusFilter" 
            (change)="onStatusFilterChange()"
            class="filter-select"
          >
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="view-toggle">
          <button 
            [class.active]="viewMode === 'list'" 
            (click)="toggleViewMode('list')"
            title="List View"
          >
            ‚ò∞
          </button>
          <button 
            [class.active]="viewMode === 'grid'" 
            (click)="toggleViewMode('grid')"
            title="Grid View"
          >
            ‚èπÔ∏è
          </button>
        </div>
      </div>
    </div>

    <!-- Quotations List -->
    <div *ngIf="filteredQuotations.length > 0">
      <!-- List View -->
      <div *ngIf="viewMode === 'list'" class="quotations-list">
        <div class="list-header">
          <div class="header-cell">QUOTATION NO</div>
          <div class="header-cell">VENDOR</div>
          <div class="header-cell">REQUEST ID</div>
          <div class="header-cell text-right">AMOUNT</div>
          <div class="header-cell">QUOTE DATE</div>
          <div class="header-cell">VALID UNTIL</div>
          <div class="header-cell">STATUS</div>
          <div class="header-cell">ACTIONS</div>
        </div>

        <div class="list-body">
          <div *ngFor="let quote of paginatedQuotations" class="list-row" (click)="viewQuotation(quote)">
            <div class="cell">
              <strong>{{ quote.quotationNumber }}</strong>
            </div>
            <div class="cell">
              {{ quote.vendor?.name || '-' }}
            </div>
            <div class="cell">
              #{{ quote.leaseRequest?.id || '-' }}
            </div>
            <div class="cell text-right">
              <strong>‚Çπ{{ quote.totalAmount | number:'1.2-2' }}</strong>
            </div>
            <div class="cell">
              {{ quote.quoteDate | date:'MMM d, y' }}
            </div>
            <div class="cell valid-until-cell" 
                 [class.expiring-soon]="isExpiringSoon(quote.validUntil) && !isExpired(quote.validUntil)"
                 [class.expired]="isExpired(quote.validUntil)">
              {{ quote.validUntil | date:'MMM d, y' }}
              <span class="expired-badge" *ngIf="isExpired(quote.validUntil)">EXPIRED</span>
            </div>
            <div class="cell status-cell">
              <span class="status-badge" 
                    [class.status-pending]="quote.status === 'PENDING'"
                    [class.status-approved]="quote.status === 'APPROVED'"
                    [class.status-rejected]="quote.status === 'REJECTED'">
                {{ quote.status || 'PENDING' }}
              </span>
            </div>
            <div class="cell actions">
              <button 
                (click)="$event.stopPropagation(); viewQuotation(quote)"
                class="btn btn-info"
                title="View Details"
              >
                üëÅÔ∏è
              </button>
              <button 
                *ngIf="quote.status === 'PENDING' || !quote.status"
                (click)="$event.stopPropagation(); approveQuotation(quote)"
                class="btn btn-success"
                title="Approve Quotation"
                [disabled]="isApproving"
              >
                ‚úÖ
              </button>
              <button 
                (click)="$event.stopPropagation(); downloadPdf(quote)"
                class="btn btn-secondary"
                title="Download PDF"
              >
                üìÑ
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Grid View -->
      <div *ngIf="viewMode === 'grid'" class="quotations-grid">
        <div *ngFor="let quote of paginatedQuotations" class="quotation-card">
          <div class="card-header">
            <h3>{{ quote.quotationNumber }}</h3>
            <span class="status-badge status-approved" *ngIf="quote.status === 'APPROVED'">Approved</span>
            <span class="status-badge status-rejected" *ngIf="quote.status === 'REJECTED'">Rejected</span>
            <span class="status-badge status-expired" *ngIf="quote.status !== 'APPROVED' && quote.status !== 'REJECTED' && isExpired(quote.validUntil)">Expired</span>
            <span class="status-badge status-warning" *ngIf="quote.status !== 'APPROVED' && quote.status !== 'REJECTED' && isExpiringSoon(quote.validUntil) && !isExpired(quote.validUntil)">Expiring Soon</span>
            <span class="status-badge status-pending" *ngIf="(quote.status === 'PENDING' || !quote.status) && !isExpired(quote.validUntil) && !isExpiringSoon(quote.validUntil)">Pending</span>
          </div>
          
          <div class="card-body">
            <div class="info-row">
              <span class="label">Vendor:</span>
              <span class="value">{{ quote.vendor?.name || '-' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Request ID:</span>
              <span class="value">#{{ quote.leaseRequest?.id || '-' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Amount:</span>
              <span class="value amount">‚Çπ{{ quote.totalAmount | number:'1.2-2' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Quote Date:</span>
              <span class="value">{{ quote.quoteDate | date:'MMM d, y' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Valid Until:</span>
              <span class="value" 
                    [class.expiring-soon]="isExpiringSoon(quote.validUntil) && !isExpired(quote.validUntil)"
                    [class.expired]="isExpired(quote.validUntil)">
                {{ quote.validUntil | date:'MMM d, y' }}
                <span class="expired-text" *ngIf="isExpired(quote.validUntil)">(Expired)</span>
              </span>
            </div>
            
            <div *ngIf="quote.termsAndConditions" class="notes">
              <span class="label">Terms:</span>
              <p class="value">{{ quote.termsAndConditions }}</p>
            </div>
            
            <div class="card-actions">
              <button 
                (click)="$event.stopPropagation(); viewQuotation(quote)"
                class="btn btn-info"
              >
                View Details
              </button>
              <button 
                *ngIf="quote.status === 'PENDING' || !quote.status"
                (click)="$event.stopPropagation(); approveQuotation(quote)"
                class="btn btn-success"
                [disabled]="isApproving"
              >
                ‚úÖ Approve
              </button>
              <button 
                (click)="$event.stopPropagation(); downloadPdf(quote)"
                class="btn btn-secondary"
              >
                Download PDF
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button 
          [disabled]="currentPage === 1" 
          (click)="changePage(currentPage - 1)"
          class="pagination-btn"
        >
          &laquo; Previous
        </button>
        
        <div class="page-numbers">
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
        </div>
        
        <button 
          [disabled]="currentPage === totalPages" 
          (click)="changePage(currentPage + 1)"
          class="pagination-btn"
        >
          Next &raquo;
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredQuotations.length === 0" class="empty-state">
      <div class="empty-icon">üìã</div>
      <h3>No quotations found</h3>
      <p *ngIf="searchTerm || statusFilter !== 'all'">There are no quotations matching your current filters.</p>
      <p *ngIf="!searchTerm && statusFilter === 'all'">No quotations received from vendors yet.</p>
      <button 
        *ngIf="searchTerm || statusFilter !== 'all'" 
        (click)="searchTerm = ''; statusFilter = 'all'; applyFilters()"
        class="btn btn-primary"
      >
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Quotation Details Modal -->
  <div *ngIf="selectedQuotation" class="modal-overlay" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Quotation Details - {{ selectedQuotation.quotationNumber }}</h2>
        <button class="close-btn" (click)="closeDetails()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="details-grid">
          <div class="detail-item">
            <span class="detail-label">Vendor:</span>
            <span class="detail-value">{{ selectedQuotation.vendor?.name || '-' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Vendor Email:</span>
            <span class="detail-value">{{ selectedQuotation.vendor?.mail || '-' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Vendor Contact:</span>
            <span class="detail-value">{{ selectedQuotation.vendor?.contactNo || '-' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Request ID:</span>
            <span class="detail-value">#{{ selectedQuotation.leaseRequest?.id || '-' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Quote Date:</span>
            <span class="detail-value">{{ selectedQuotation.quoteDate | date:'mediumDate' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Valid Until:</span>
            <span class="detail-value">{{ selectedQuotation.validUntil | date:'mediumDate' }}</span>
          </div>
        </div>
        
        <div class="items-table">
          <h3>Quotation Details</h3>
          <table>
            <thead>
              <tr>
                <th>Description</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Unit Price</th>
                <th class="text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ selectedQuotation.itemDescription }}</td>
                <td class="text-right">{{ selectedQuotation.itemQuantity }}</td>
                <td class="text-right">‚Çπ{{ selectedQuotation.unitPrice | number:'1.2-2' }}</td>
                <td class="text-right">‚Çπ{{ selectedQuotation.subtotal | number:'1.2-2' }}</td>
              </tr>
              <tr>
                <td colspan="3" class="text-right">Tax ({{ selectedQuotation.taxPercent }}%):</td>
                <td class="text-right">‚Çπ{{ selectedQuotation.taxAmount | number:'1.2-2' }}</td>
              </tr>
              <tr class="total-row">
                <td colspan="3" class="text-right"><strong>Total Amount:</strong></td>
                <td class="text-right"><strong>‚Çπ{{ selectedQuotation.totalAmount | number:'1.2-2' }}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="detail-item full-width" *ngIf="selectedQuotation.termsAndConditions">
          <span class="detail-label">Terms & Conditions:</span>
          <p class="detail-value notes">{{ selectedQuotation.termsAndConditions }}</p>
        </div>
        
        <div class="modal-actions">
          <button 
            *ngIf="selectedQuotation.status === 'PENDING' || !selectedQuotation.status"
            (click)="approveQuotation(selectedQuotation)"
            class="btn btn-success"
            [disabled]="isApproving"
          >
            ‚úÖ {{ isApproving ? 'Approving...' : 'Approve Quotation' }}
          </button>
          <button 
            (click)="downloadPdf(selectedQuotation)"
            class="btn btn-primary"
          >
            Download PDF
          </button>
          <button 
            (click)="closeDetails()"
            class="btn btn-secondary"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
